<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-12-26T16:45:30.276925"><meta name="build-number" content="${buildNumber}">       <title>Map-first preprocessing | DITA Open Toolkit 4.1</title><script id="virtual-toc-data" type="application/json">[{"id":"how-to-use-map-first-preprocessing","level":0,"title":"How to use map-first preprocessing","anchor":"#how-to-use-map-first-preprocessing"},{"id":"how-to-test-in-a-production-environment","level":0,"title":"How to test in a production environment","anchor":"#how-to-test-in-a-production-environment"},{"id":"known-limitations","level":0,"title":"Known limitations","anchor":"#known-limitations"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Map-first preprocessing | DITA Open Toolkit 4.1"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="DITA Open Toolkit 4.1 Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="map-first-preprocessing.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Map-first preprocessing | DITA Open Toolkit 4.1"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "map-first-preprocessing.html#webpage", "url": "map-first-preprocessing.html", "name": "Map-first preprocessing | DITA Open Toolkit 4.1", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/#website", "url": "/", "name": "DITA Open Toolkit 4.1 Help" }</script><!-- End Schema.org --></head>      <body data-id="map-first-preprocessing" data-main-title="Map-first preprocessing" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="reference_index.md|Reference///architecture.md|DITA Open Toolkit Architecture"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>DITA Open Toolkit 4.1  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="map-first-preprocessing"   id="map-first-preprocessing.md">Map-first preprocessing</h1>  <p id="b1cb8c29_3">DITA-OT 3.0 provides a map-first preprocessing option as an alternative to the default <code class="code" id="b1cb8c29_4">preprocess</code> operation. The method, which was introduced in DITA-OT 2.5 as an experimental feature, has been improved and is ready for use in many production scenarios. Map-first-preprocessing provides the same functionality as the default <code class="code" id="b1cb8c29_5">preprocess</code>, but takes a different approach.</p><p id="b1cb8c29_6">Whereas the default preprocessing routine handles both maps and topics at the same time, often switching back and forth between map operations and topic operations, the map-first approach only begins processing topics after nearly all map processing is complete. This simplifies the processing logic and creates cleaner module responsibilities, which makes it easier to process only those topics that are actually referenced after filtering, for example, or to only process the map to validate the map structure.</p><p id="b1cb8c29_7">The current preprocessing architecture was established during the DITA 1.0 era when there were fewer DITA features that operated on the map level. Initially, the difference between processing modes was not that great. DITA 1.2 and 1.3 introduced many more map-level features, such as keys and key scopes, that make it difficult to reliably work with topics before all map features have been resolved.</p><p id="b1cb8c29_8">The original preprocessing operation already handles many map operations first, but this was not the original design and requires regular refactoring to handle edge cases. The new map-first preprocessing is designed with this model in mind, improving the overall processing flow and making it more formal about the map-first model. The new model also takes advantage of hashed topic file names in the temporary directory, which simplifies many processing steps, and is better able to handle topics referenced outside of the map directory (that case has resulted in a variety of issues with the original model).</p><p id="b1cb8c29_9"><span class="control" id="b1cb8c29_10">Note:</span> The map-first preprocessing option is enabled by default in DITA-OT 3.0 for PDF and HTML Help. These formats were chosen because they generate a compiled result file, so temporarily hashed file names should all be invisible to the build. After further testing and feedback, the new option will most likely become the default for other output formats in future versions. Because the DITA-OT development team cannot have access to all varieties of DITA, all edge cases, or even all the ways DITA-OT itself is extended, the switch to default map-first preprocessing for other output formats will be smoother for everyone if more people can test and provide feedback.</p><section class="chapter"><h2 id="how-to-use-map-first-preprocessing" data-toc="how-to-use-map-first-preprocessing"   >How to use map-first preprocessing</h2><p id="b1cb8c29_11">To use (or test) map-first preprocessing, call the <code class="code" id="b1cb8c29_12">preprocess2</code> Ant target in your custom transformation types instead of using the default <code class="code" id="b1cb8c29_13">preprocess</code> target.</p><p id="b1cb8c29_14">For example, if you have a custom HTML5 transformation type named &quot;myhtml&quot;, then you may have a plug-in extension that looks this:</p><div class="code-block" data-lang="none"         >
&lt;!-- Simple variant: set properties and call default HTML5 --&gt;
&lt;target name=&quot;dita2myhtml&quot; depends=&quot;myhtml.init,dita2html5&quot;/&gt;

</div><p id="b1cb8c29_16">This type of extension is quite common, and is used to set default properties for your environment followed by a normal build to use those properties. In this case, you'll need to replace <code class="code" id="b1cb8c29_17">dita2html5</code> with the normal HTML5 steps, swapping out <code class="code" id="b1cb8c29_18">preprocess</code> for <code class="code" id="b1cb8c29_19">preprocess2</code>:</p><div class="code-block" data-lang="none"         >
&lt;!-- Simple variant: set properties and call default HTML5 --&gt;
&lt;target name=&quot;dita2myhtml&quot; 
        depends=&quot;myhtml.init,
                 html5.init,
                 build-init,
                 **preprocess2,**
                 html5.topic,
                 html5.map,
                 html5.css&quot;/&gt;
</div><p id="b1cb8c29_21"><span class="control" id="b1cb8c29_22">Note:</span> If you use this simple method for customized PDF or HTML Help builds, you will automatically be using <code class="code" id="b1cb8c29_23">preprocess2</code>.</p><p id="b1cb8c29_24">Some custom transformation types already require you to repeat the default dependencies, in which case you should already call <code class="code" id="b1cb8c29_25">preprocess</code> directly, as in the following:</p><div class="code-block" data-lang="none"         >
&lt;!-- More complex variant: add processing steps to default HTML5 --&gt;
&lt;target name=&quot;dita2myhtml&quot;
        depends=&quot;myhtml.init,
                 build-init,
                 preprocess,
                 local-extensions-after-preprocess,
                 html5.topic,
                 html5.map,
                 html5.css&quot;/&gt;
</div><p id="b1cb8c29_27">In such cases, the modification is much easier &ndash; simply add a <code class="code" id="b1cb8c29_28">2</code> to the existing <code class="code" id="b1cb8c29_29">preprocess</code> target.</p></section><section class="chapter"><h2 id="how-to-test-in-a-production-environment" data-toc="how-to-test-in-a-production-environment"   >How to test in a production environment</h2><p id="b1cb8c29_30">In some cases, you may be responsible for maintaining transformation types that are actually run by many people on your team or around a company. In this case, you likely need to maintain your existing transformation types based on the backwards-compatible <code class="code" id="b1cb8c29_31">preprocess</code> modules, but also want to provide your colleagues with a way to test their own documents using <code class="code" id="b1cb8c29_32">preprocess2</code>.</p><p id="b1cb8c29_33">There are several ways to do this. One fairly straightforward approach would be to create a new custom transformation type that is exactly the same, except for preprocessing. For example, if you have a local HTML variant called <code class="code" id="b1cb8c29_34">myhtml</code> as above, instead of modifying that transformation directly, you could create a second transformation type called <code class="code" id="b1cb8c29_35">myhtml-beta</code> that provides exactly the same support, but with the new map-first preprocessing:</p><div class="code-block" data-lang="none"         >
*&amp;lt;!-- Original &quot;myhtml&quot; is not modified, used for production --&amp;gt;*
&lt;target name=&quot;dita2myhtml5&quot; depends=&quot;myhtml.init,dita2html5&quot;/&gt;

*&amp;lt;!-- &quot;myhtml-beta&quot; used to test and provide feedback on preprocess2 --&amp;gt;*
&lt;target name=&quot;dita2myhtml-beta&quot; 
        depends=&quot;myhtml.init,
                 html5.init,
                 build-init,
                 **preprocess2,**
                 html5.topic,
                 html5.map,
                 html5.css&quot;/&gt;
</div></section><section class="chapter"><h2 id="known-limitations" data-toc="known-limitations"   >Known limitations</h2><p id="b1cb8c29_37">The <code class="code" id="b1cb8c29_38">preprocess2</code> implementation details are subject to change; dependencies within <code class="code" id="b1cb8c29_39">preprocess2</code> may be renamed or removed based on feedback.</p><p id="b1cb8c29_40">The internal extension points that run before or after individual steps in the original <code class="code" id="b1cb8c29_41">preprocess</code> pipeline (<code class="code" id="b1cb8c29_42">preprocess.*.pre/preprocess.*.post</code>) are not available in the newer map-first preprocessing pipeline (<code class="code" id="b1cb8c29_43">preprocess2</code>), which is used in the PDF and HTML Help transformations as of DITA-OT 3.0.</p><p id="b1cb8c29_44"><span class="control" id="b1cb8c29_45">Related information</span></p><p id="b1cb8c29_46"><a href="https://www.oxygenxml.com/events/2017/dita-ot_day.html#preprocess_2" id="b1cb8c29_47"   data-external="true" rel="noopener noreferrer" >We shall call it preprocess2</a></p></section><div class="last-modified"> Last modified: 26 December 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="processing-structure.html">Processing structure</a>   <a class="navigation-links__next" href="processing-pipeline-modules.html">Processing modules</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>