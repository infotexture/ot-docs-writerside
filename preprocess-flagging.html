<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-02-13T09:29:37.507939"><title>Flagging (`flag-module`) | DITA Open Toolkit 4.1</title><script type="application/json" id="virtual-toc-data">[{"id":"evaluating-the-ditaval-flags","level":0,"title":"Evaluating the DITAVAL flags","anchor":"#evaluating-the-ditaval-flags"},{"id":"supporting-flags-in-overrides-or-custom-transformation-types","level":0,"title":"Supporting flags in overrides or custom transformation types","anchor":"#supporting-flags-in-overrides-or-custom-transformation-types"},{"id":"example-ditaval","level":0,"title":"Example DITAVAL","anchor":"#example-ditaval"},{"id":"content-example-1-adding-style","level":0,"title":"Content example 1: Adding style","anchor":"#content-example-1-adding-style"},{"id":"content-example-2-conflicting-styles","level":0,"title":"Content example 2: Conflicting styles","anchor":"#content-example-2-conflicting-styles"},{"id":"content-example-3-adding-image-flags","level":0,"title":"Content example 3: Adding image flags","anchor":"#content-example-3-adding-image-flags"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Flagging (`flag-module`) | DITA Open Toolkit 4.1"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="DITA Open Toolkit 4.1 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="preprocess-flagging.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Flagging (`flag-module`) | DITA Open Toolkit 4.1"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "preprocess-flagging.html#webpage",
    "url": "preprocess-flagging.html",
    "name": "Flagging (`flag-module`) | DITA Open Toolkit 4.1",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "/#website",
    "url": "/",
    "name": "DITA Open Toolkit 4.1 Help"
}</script><!-- End Schema.org --></head><body data-id="preprocess-flagging" data-main-title="Flagging (`flag-module`)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="reference_index.md|Reference///architecture.md|DITA Open Toolkit Architecture///preprocessing.md|Pre-processing modules"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>DITA Open Toolkit 4.1  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="preprocess-flagging" id="preprocess-flagging.md">Flagging (`flag-module`)</h1><p id="14de8039_3">Beginning with DITA-OT 1.7, flagging support is implemented as a common <code class="code" id="14de8039_4">flag-module</code> preprocessing step. The module evaluates the DITAVAL against all flagging attributes, and adds DITA-OT&ndash;specific hints to the topic when flags are active. Any extended transformation type may use these hints to support flagging without adding logic to interpret the DITAVAL.</p><section class="chapter"><h2 id="evaluating-the-ditaval-flags" data-toc="evaluating-the-ditaval-flags">Evaluating the DITAVAL flags</h2><p id="14de8039_5">Flagging is implemented as a reusable module during the preprocess stage. If a DITAVAL file is not used with a build, this step is skipped with no change to the file.</p><p id="14de8039_6">When a flag is active, relevant sections of the DITAVAL itself are copied into the topic as a sub-element of the current topic. The active flags are enclosed in a pseudo-specialization of the <code class="code" id="14de8039_7">&lt;foreign&gt;</code> element (referred to as a pseudo-specialization because it is used only under the covers, with all topic types; it is not integrated into any shipped document types).</p><ul class="list _ul" id="14de8039_8"><li class="list__item" id="14de8039_9"><p id="14de8039_10"><span class="control" id="14de8039_11"><code class="code" id="14de8039_12">&lt;ditaval-startprop&gt;</code></span></p><p id="14de8039_13">When any flag is active on an element, a <code class="code" id="14de8039_14">&lt;ditaval-startprop&gt;</code> element will be created as the first child of the flagged element:</p><div class="code-block" data-lang="none">
&lt;ditaval-startprop class=&quot;+ topic/foreign ditaot-d/ditaval-startprop &quot;&gt;
</div><p id="14de8039_16">The <code class="code" id="14de8039_17">&lt;ditaval-startprop&gt;</code> element will contain the following:</p><ul class="list _ul" id="14de8039_18"><li class="list__item" id="14de8039_19"><p>If the active flags should create a new style, that style is included using standard CSS markup on the <code class="code" id="14de8039_20">@outputclass</code> attribute. Output types that make use of CSS, such as XHTML, can use this value as-is.</p></li><li class="list__item" id="14de8039_21"><p>If styles conflict, and a <code class="code" id="14de8039_22">&lt;style-conflict&gt;</code> element exists in the DITAVAL, it will be copied as a child of <code class="code" id="14de8039_23">&lt;ditaval-startprop&gt;</code>.</p></li><li class="list__item" id="14de8039_24"><p>Any <code class="code" id="14de8039_25">&lt;prop&gt;</code> or <code class="code" id="14de8039_26">&lt;revprop&gt;</code> elements that define active flags will be copied in as children of the <code class="code" id="14de8039_27">&lt;ditaval-startprop&gt;</code> element. Any <code class="code" id="14de8039_28">&lt;startflag&gt;</code> children of the properties will be included, but <code class="code" id="14de8039_29">&lt;endflag&gt;</code> children will not.</p></li></ul></li><li class="list__item" id="14de8039_30"><p id="14de8039_31"><span class="control" id="14de8039_32"><code class="code" id="14de8039_33">&lt;ditaval-endprop&gt;</code></span></p><p id="14de8039_34">When any flag is active on an element, a <code class="code" id="14de8039_35">&lt;ditaval-endprop&gt;</code> element will be created as the last child of the flagged element:</p><div class="code-block" data-lang="none">
&lt;ditaval-endprop class=&quot;+ topic/foreign ditaot-d/ditaval-endprop &quot;&gt;
</div><p id="14de8039_37">CSS values and <code class="code" id="14de8039_38">&lt;style-conflict&gt;</code> elements are not included on this element.</p><p id="14de8039_39">Any <code class="code" id="14de8039_40">&lt;prop&gt;</code> or <code class="code" id="14de8039_41">&lt;revprop&gt;</code> elements that define active flags will be copied in as children of <code class="code" id="14de8039_42">&lt;ditaval-prop&gt;</code>. Any <code class="code" id="14de8039_43">&lt;startflag&gt;</code> children of the properties will be included, but <code class="code" id="14de8039_44">&lt;endflag&gt;</code> children will not.</p></li></ul></section><section class="chapter"><h2 id="supporting-flags-in-overrides-or-custom-transformation-types" data-toc="supporting-flags-in-overrides-or-custom-transformation-types">Supporting flags in overrides or custom transformation types</h2><p id="14de8039_45">For most transformation types, the <code class="code" id="14de8039_46">&lt;foreign&gt;</code> element should be ignored by default, because arbitrary non-DITA content may not mix well unless coded for ahead of time. If the <code class="code" id="14de8039_47">&lt;foreign&gt;</code> element is ignored by default, or if a rule is added to specifically ignore <code class="code" id="14de8039_48">&lt;ditaval-startprop&gt;</code> and <code class="code" id="14de8039_49">&lt;ditaval-endprop&gt;</code>, then the added elements will have no impact on a transform. If desired, flagging support may be integrated at any time in the future.</p><p id="14de8039_50">The processing described above runs as part of the common preprocess, so any transform that uses the default preprocess will get the topic updates. To support generating flags as images, XSLT-based transforms can use default fallthrough processing in most cases. For example, if a paragraph is flagged, the first child of <code class="code" id="14de8039_51">&lt;p&gt;</code> will contain the start flag information; adding a rule to handle images in <code class="code" id="14de8039_52">&lt;ditaval-startprop&gt;</code> will cause the image to appear at the start of the paragraph content.</p><p id="14de8039_53">In some cases fallthrough processing will not result in valid output; for those cases, the flags must be explicitly processed. This is done in the XHTML transform for elements like <code class="code" id="14de8039_54">&lt;ol&gt;</code>, because fallthrough processing would place images in between <code class="code" id="14de8039_55">&lt;ol&gt;</code> and <code class="code" id="14de8039_56">&lt;li&gt;</code>. To handle this, the code processes <code class="code" id="14de8039_57">&lt;ditaval-startprop&gt;</code> before starting the element, and <code class="code" id="14de8039_58">&lt;ditaval-endprop&gt;</code> at the end. Fallthrough processing is then disabled for those elements as children of <code class="code" id="14de8039_59">&lt;ol&gt;</code>.</p></section><section class="chapter"><h2 id="example-ditaval" data-toc="example-ditaval">Example DITAVAL</h2><p id="14de8039_60">Assume the following DITAVAL file is in use during a build. This DITAVAL will be used for each of the following content examples.</p><div class="code-block" data-lang="none">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;val&gt;
  *&amp;lt;!-- Define what happens in the case of conflicting styles --&amp;gt;*
  &lt;style-conflict background-conflict-color=&quot;red&quot;/&gt;

  *&amp;lt;!-- Define two flagging properties that give styles \(no image\) --&amp;gt;*
  &lt;prop action=&quot;flag&quot; att=&quot;audience&quot; style=&quot;underline&quot; val=&quot;user&quot;
        backcolor=&quot;green&quot;/&gt;
  &lt;prop action=&quot;flag&quot; att=&quot;platform&quot; style=&quot;overline&quot; val=&quot;win&quot;
        backcolor=&quot;blue&quot;/&gt;

  *&amp;lt;!-- Define a property that includes start and end image flags --&amp;gt;*
  &lt;prop action=&quot;flag&quot; att=&quot;platform&quot; val=&quot;linux&quot; style=&quot;overline&quot;
        backcolor=&quot;blue&quot;&gt;
    &lt;startflag imageref=&quot;startlin.png&quot;&gt;
      &lt;alt-text&gt;Start linux&lt;/alt-text&gt;&lt;/startflag&gt;
    &lt;endflag imageref=&quot;endlin.png&quot;&gt;
      &lt;alt-text&gt;End linux&lt;/alt-text&gt;&lt;/endflag&gt;
  &lt;/prop&gt;

  *&amp;lt;!-- Define a revision that includes start and end image flags --&amp;gt;*
  &lt;revprop action=&quot;flag&quot; style=&quot;double-underline&quot; val=&quot;rev2&quot;&gt;
    &lt;startflag imageref=&quot;start_rev.gif&quot;&gt;
      &lt;alt-text&gt;START&lt;/alt-text&gt;&lt;/startflag&gt;
    &lt;endflag imageref=&quot;end_rev.gif&quot;&gt;&lt;alt-text&gt;END&lt;/alt-text&gt;&lt;/endflag&gt;
  &lt;/revprop&gt;
&lt;/val&gt;
</div></section><section class="chapter"><h2 id="content-example-1-adding-style" data-toc="content-example-1-adding-style">Content example 1: Adding style</h2><p id="14de8039_62">Now assume the following paragraph exists in a topic. Class attributes are included, as they would normally be in the middle of the preprocess routine; <code class="code" id="14de8039_63">@xtrf</code> and <code class="code" id="14de8039_64">@xtrc</code> are left off for clarity.</p><div class="code-block" data-lang="none">
&lt;p audience=&quot;user&quot;&gt;Simple user; includes style but no images&lt;/p&gt;
</div><p id="14de8039_66">Based on the DITAVAL above, audience=&quot;user&quot; results in a style with underlining and with a green background. The interpreted CSS value is added to <code class="code" id="14de8039_67">@outputclass</code> on <code class="code" id="14de8039_68">&lt;ditaval-startprop&gt;</code>, and the actual property definition is included at the start and end of the element. The output from the flagging step looks like this (with newlines added for clarity, and class attributes added as they would appear in the temporary file):</p><p id="14de8039_69">The resulting file after the flagging step looks like this; for clarity, newlines are added, while <code class="code" id="14de8039_70">@xtrf</code> and <code class="code" id="14de8039_71">@xtrc</code> are removed:</p><div class="code-block" data-lang="none">
&lt;p audience=&quot;user&quot; class=&quot;- topic/p &quot;&gt;
  **&amp;lt;ditaval-startprop**
      **class=&quot;+ topic/foreign ditaot-d/ditaval-startprop &quot;**
      **outputclass=&quot;background-color:green;text-decoration:underline;&quot;&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;audience&quot; style=&quot;underline&quot; val=&quot;user&quot;
          backcolor=&quot;green&quot;/&amp;gt;**
  **&amp;lt;/ditaval-startprop&amp;gt;**
  Simple user; includes style but no images
  **&amp;lt;ditaval-endprop**
      **class=&quot;+ topic/foreign ditaot-d/ditaval-endprop &quot;&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;audience&quot; style=&quot;underline&quot; val=&quot;user&quot;
          backcolor=&quot;green&quot;/&amp;gt;**
  **&amp;lt;/ditaval-endprop&amp;gt;**
&lt;/p&gt;
</div></section><section class="chapter"><h2 id="content-example-2-conflicting-styles" data-toc="content-example-2-conflicting-styles">Content example 2: Conflicting styles</h2><p id="14de8039_73">This example includes a paragraph with conflicting styles. When the audience and platform attributes are both evaluated, the DITAVAL indicates that the background color is both green and blue. In this situation, the <code class="code" id="14de8039_74">&lt;style-conflict&gt;</code> element is evaluated to determine how to style the content.</p><div class="code-block" data-lang="none">
&lt;p audience=&quot;user&quot; platform=&quot;win&quot;&gt;Conflicting styles (still no images)&lt;/p&gt;
</div><p id="14de8039_76">The <code class="code" id="14de8039_77">&lt;style-conflict&gt;</code> element results in a background color of red, so this value is added to <code class="code" id="14de8039_78">@outputclass</code> on <code class="code" id="14de8039_79">&lt;ditaval-startprop&gt;</code>. As above, active properties are copied into the generated elements; the <code class="code" id="14de8039_80">&lt;style-conflict&gt;</code> element itself is also copied into the generated <code class="code" id="14de8039_81">&lt;ditaval-startprop&gt;</code> element.</p><p id="14de8039_82">The resulting file after the flagging step looks like this; for clarity, newlines are added, while <code class="code" id="14de8039_83">@xtrf</code> and <code class="code" id="14de8039_84">@xtrc</code> are removed:</p><div class="code-block" data-lang="none">
&lt;p audience=&quot;user&quot; platform=&quot;win&quot; class=&quot;- topic/p &quot;&gt;
  **&amp;lt;ditaval-startprop**
           **class=&quot;+ topic/foreign ditaot-d/ditaval-startprop &quot;**
           **outputclass=&quot;background-color:red;&quot;&amp;gt;**
    **&amp;lt;style-conflict background-conflict-color=&quot;red&quot;/&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;audience&quot; style=&quot;underline&quot; val=&quot;user&quot;
          backcolor=&quot;green&quot;/&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;platform&quot; style=&quot;overline&quot; val=&quot;win&quot;
          backcolor=&quot;blue&quot;/&amp;gt;**
  **&amp;lt;/ditaval-startprop&amp;gt;**

  Conflicting styles (still no images)

  **&amp;lt;ditaval-endprop**
           **class=&quot;+ topic/foreign ditaot-d/ditaval-endprop &quot;&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;platform&quot; style=&quot;overline&quot; val=&quot;win&quot;
          backcolor=&quot;blue&quot;/&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;audience&quot; style=&quot;underline&quot; val=&quot;user&quot;
          backcolor=&quot;green&quot;/&amp;gt;****
  &amp;lt;/ditaval-endprop&amp;gt;**
&lt;/p&gt;
</div></section><section class="chapter"><h2 id="content-example-3-adding-image-flags" data-toc="content-example-3-adding-image-flags">Content example 3: Adding image flags</h2><p id="14de8039_86">This example includes image flags for both <code class="code" id="14de8039_87">@platform</code> and <code class="code" id="14de8039_88">@rev</code>, which are defined in DITAVAL <code class="code" id="14de8039_89">&lt;prop&gt;</code> and <code class="code" id="14de8039_90">&lt;revprop&gt;</code> elements.</p><div class="code-block" data-lang="none">
&lt;ol platform=&quot;linux&quot; rev=&quot;rev2&quot;&gt;
  &lt;li&gt;Generate images for platform=&quot;linux&quot; and rev=&quot;2&quot;&lt;/li&gt;
&lt;/ol&gt;
</div><p id="14de8039_92">As above, the <code class="code" id="14de8039_93">&lt;ditaval-startprop&gt;</code> and <code class="code" id="14de8039_94">&lt;ditaval-endprop&gt;</code> nest the active property definitions, with the calculated CSS value on <code class="code" id="14de8039_95">@outputclass</code>. The <code class="code" id="14de8039_96">&lt;ditaval-startprop&gt;</code> drops the ending image, and <code class="code" id="14de8039_97">&lt;ditaval-endprop&gt;</code> drops the starting image. To make document-order processing more consistent, property flags are always included before revisions in <code class="code" id="14de8039_98">&lt;ditaval-startprop&gt;</code>, and the order is reversed for <code class="code" id="14de8039_99">&lt;ditaval-endprop&gt;</code>.</p><p id="14de8039_100">The resulting file after the flagging step looks like this; for clarity, newlines are added, while <code class="code" id="14de8039_101">@xtrf</code> and <code class="code" id="14de8039_102">@xtrc</code> are removed:</p><div class="code-block" data-lang="none">
&lt;ol platform=&quot;linux&quot; rev=&quot;rev2&quot; class=&quot;- topic/ol &quot;&gt;
  **&amp;lt;ditaval-startprop**
           **class=&quot;+ topic/foreign ditaot-d/ditaval-startprop &quot;**
           **outputclass=&quot;background-color:blue;**
                        **text-decoration:underline;**
                        **text-decoration:overline;&quot;&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;platform&quot; val=&quot;linux&quot; style=&quot;overline&quot;
          backcolor=&quot;blue&quot;&amp;gt;**
      **&amp;lt;startflag imageref=&quot;startlin.png&quot;&amp;gt;**
        **&amp;lt;alt-text&amp;gt;Start linux&amp;lt;/alt-text&amp;gt;&amp;lt;/startflag&amp;gt;&amp;lt;/prop&amp;gt;**
    **&amp;lt;revprop action=&quot;flag&quot; style=&quot;double-underline&quot; val=&quot;rev2&quot;&amp;gt;**
      **&amp;lt;startflag imageref=&quot;start\_rev.gif&quot;&amp;gt;**
        **&amp;lt;alt-text&amp;gt; &amp;lt;/alt-text&amp;gt;&amp;lt;/startflag&amp;gt;&amp;lt;/revprop&amp;gt;**
  **&amp;lt;/ditaval-startprop&amp;gt;**
  &lt;li class=&quot;- topic/li &quot;&gt;
    Generate images for platform=&quot;linux&quot; and rev=&quot;2&quot;
  &lt;/li&gt;
  **&amp;lt;ditaval-endprop**
           **class=&quot;+ topic/foreign ditaot-d/ditaval-endprop &quot;&amp;gt;**
    **&amp;lt;revprop action=&quot;flag&quot; style=&quot;double-underline&quot; val=&quot;rev2&quot;&amp;gt;**
      **&amp;lt;endflag imageref=&quot;end\_rev.gif&quot;&amp;gt;**
        **&amp;lt;alt-text&amp;gt;END&amp;lt;/alt-text&amp;gt;&amp;lt;/endflag&amp;gt;&amp;lt;/revprop&amp;gt;**
    **&amp;lt;prop action=&quot;flag&quot; att=&quot;platform&quot; val=&quot;linux&quot; style=&quot;overline&quot;**
                                                   **backcolor=&quot;blue&quot;&amp;gt;**
      **&amp;lt;endflag imageref=&quot;endlin.png&quot;&amp;gt;**
        **&amp;lt;alt-text&amp;gt;End linux&amp;lt;/alt-text&amp;gt;&amp;lt;/endflag&amp;gt;&amp;lt;/prop&amp;gt;**
  **&amp;lt;/ditaval-endprop&amp;gt;**
&lt;/ol&gt;
</div></section><div class="last-modified">Last modified: 13 February 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="preprocess-topicpull.html" class="navigation-links__prev">Pull content into topics (`topicpull`)</a><a href="preprocess-clean-map.html" class="navigation-links__next">Map cleanup (`clean-map`)</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>