<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-02-13T09:29:37.514782"><title>Extended codeblock processing | DITA Open Toolkit 4.1</title><script type="application/json" id="virtual-toc-data">[{"id":"character-set-definition","level":0,"title":"Character set definition","anchor":"#character-set-definition"},{"id":"line-range-extraction","level":0,"title":"Line range extraction","anchor":"#line-range-extraction"},{"id":"rfc-5147","level":0,"title":"RFC 5147","anchor":"#rfc-5147"},{"id":"line-range-by-content","level":0,"title":"Line range by content","anchor":"#line-range-by-content"},{"id":"whitespace-normalization","level":0,"title":"Whitespace normalization","anchor":"#whitespace-normalization"},{"id":"whitespace-visualization-pdf","level":0,"title":"Whitespace visualization (PDF)","anchor":"#whitespace-visualization-pdf"},{"id":"line-numbering-pdf","level":0,"title":"Line numbering (PDF)","anchor":"#line-numbering-pdf"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.css" rel="stylesheet"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Extended codeblock processing | DITA Open Toolkit 4.1"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="DITA Open Toolkit 4.1 Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="extended-functionality.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Extended codeblock processing | DITA Open Toolkit 4.1"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "extended-functionality.html#webpage",
    "url": "extended-functionality.html",
    "name": "Extended codeblock processing | DITA Open Toolkit 4.1",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "/#website",
    "url": "/",
    "name": "DITA Open Toolkit 4.1 Help"
}</script><!-- End Schema.org --></head><body data-id="extended-functionality" data-main-title="Extended codeblock processing" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="reference_index.md|Reference///dita-spec-support.md|DITA specification support"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>DITA Open Toolkit 4.1  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="extended-functionality" id="extended-functionality.md">Extended codeblock processing</h1><p id="12b8e5b0_2">DITA-OT provides additional processing support beyond that which is mandated by the DITA specification. These extensions can be used to define character encodings or line ranges for code references, normalize indendation, add line numbers or display whitespace characters in code blocks.</p><section class="chapter"><h2 id="character-set-definition" data-toc="character-set-definition">Character set definition</h2><p id="12b8e5b0_3">For <code class="code" id="12b8e5b0_4">&lt;coderef&gt;</code> elements, DITA-OT supports defining the code reference target file encoding using the <code class="code" id="12b8e5b0_5">@format</code> attribute. The supported format is:</p><div class="code-block" data-lang="none">
format (&quot;;&quot; space* &quot;charset=&quot; charset)?
</div><p id="12b8e5b0_7">If a character set is not defined, the system default character set will be used. If the character set is not recognized or supported, the DOTJ052E error is thrown and the system default character set is used as a fallback.</p><div class="code-block" data-lang="none">
&lt;coderef href=&quot;unicode.txt&quot; format=&quot;txt; charset=UTF-8&quot;/&gt;
</div><p id="12b8e5b0_9">As of DITA-OT 3.3, the default character set for code references can be changed by adding the <span class="control" id="12b8e5b0_10">default.coderef-charset</span> key to the <a href="configuration-properties-file.html" id="12b8e5b0_11" data-tooltip="The configuration.properties file controls certain common properties, as well as some properties that control PDF processing.">configuration.properties</a> file:</p><div class="code-block" data-lang="none">
default.coderef-charset = ISO-8859-1
</div><p id="12b8e5b0_13">The character set values are those supported by the Java <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/charset/Charset.html" id="12b8e5b0_14" data-external="true" rel="noopener noreferrer">Charset</a> class.</p><p id="12b8e5b0_15"><span class="control" id="12b8e5b0_16">Note:</span> As of DITA-OT 4.0, the default character set for code references has been changed from the system default encoding to UTF-8.</p></section><section class="chapter"><h2 id="line-range-extraction" data-toc="line-range-extraction">Line range extraction</h2><p id="12b8e5b0_17">Code references can be limited to extract only a specified line range by defining the <code class="code" id="12b8e5b0_18">line-range</code> pointer in the URI fragment. The format is:</p><div class="code-block" data-lang="none">
uri (&quot;#line-range(&quot; start (&quot;,&quot; end)? &quot;)&quot; )?
</div><p id="12b8e5b0_20">Start and end line numbers start from 1 and are inclusive. If the end range is omitted, the range ends on the last line of the file.</p><div class="code-block" data-lang="none">
&lt;coderef href=&quot;Parser.scala#line-range(5,10)&quot; format=&quot;scala&quot;/&gt;
</div><p id="12b8e5b0_22">Only lines from 5 to 10 will be included in the output.</p></section><section class="chapter"><h2 id="rfc-5147" data-toc="rfc-5147">RFC 5147</h2><p id="12b8e5b0_23">DITA-OT also supports the line position and range syntax from <a href="http://tools.ietf.org/html/rfc5147" id="12b8e5b0_24" data-external="true" rel="noopener noreferrer">RFC 5147</a>. The format for line range is:</p><div class="code-block" data-lang="none">
uri (&quot;#line=&quot; start? &quot;,&quot; end? )?
</div><p id="12b8e5b0_26">Start and end line numbers start from 0 and are inclusive and exclusive, respectively. If the start range is omitted, the range starts from the first line; if the end range is omitted, the range ends on the last line of the file. The format for line position is:</p><div class="code-block" data-lang="none">
uri (&quot;#line=&quot; position )?
</div><p id="12b8e5b0_28">The position line number starts from 0.</p><div class="code-block" data-lang="none">
&lt;coderef href=&quot;Parser.scala#line=4,10&quot; format=&quot;scala&quot;/&gt;
</div><p id="12b8e5b0_30">Only lines from 5 to 10 will be included in the output.</p></section><section class="chapter"><h2 id="line-range-by-content" data-toc="line-range-by-content">Line range by content</h2><p id="12b8e5b0_31">Instead of specifying line numbers, you can also select lines to include in the code reference by specifying keywords (or &ldquo;tokens&rdquo;) that appear in the referenced file.</p><p id="12b8e5b0_32">DITA-OT supports the <code class="code" id="12b8e5b0_33">token</code> pointer in the URI fragment to extract a line range based on the file content. The format for referencing a range of lines by content is:</p><div class="code-block" data-lang="none">
uri (&quot;#token=&quot; start? (&quot;,&quot; end)? )?
</div><p id="12b8e5b0_35">Lines identified using start and end tokens are exclusive: the lines that contain the start token and end token will be not be included. If the start token is omitted, the range starts from the first line in the file; if the end token is omitted, the range ends on the last line of the file.</p><p id="12b8e5b0_36">Given a Haskell source file named <code class="code" id="12b8e5b0_37">fact.hs</code> with the following content,</p><div class="code-block" data-lang="none">
-- START-FACT
fact :: Int -&gt; Int
fact 0 = 1
fact n = n * fact (n-1)
-- END-FACT
main = print $ fact 7
</div><p id="12b8e5b0_39">a range of lines can be referenced as:</p><div class="code-block" data-lang="none">
&lt;coderef href=&quot;fact.hs#token=START-FACT,END-FACT&quot;/&gt;
</div><p id="12b8e5b0_41">to include the range of lines that follows the <code class="code" id="12b8e5b0_42">START-FACT</code> token on Line 1, up to (but not including) the line that contains the <code class="code" id="12b8e5b0_43">END-FACT</code> token (Line 5). The resulting <code class="code" id="12b8e5b0_44">&lt;codeblock&gt;</code> would contain lines 2&ndash;4:</p><div class="code-block" data-lang="none">
fact :: Int -&gt; Int
fact 0 = 1
fact n = n * fact (n-1)
</div><p id="12b8e5b0_46"><span class="control" id="12b8e5b0_47">Tip:</span> This approach can be used to reference code samples that are frequently edited. In these cases, referencing line ranges by line number can be error-prone, as the target line range for the reference may shift if preceding lines are added or removed. Specifying ranges by line content makes references more robust, as long as the <code class="code" id="12b8e5b0_48">token</code> keywords are preserved when the referenced resource is modified.</p></section><section class="chapter"><h2 id="whitespace-normalization" data-toc="whitespace-normalization">Whitespace normalization</h2><p id="12b8e5b0_49">DITA-OT can adjust the leading whitespace in code blocks to remove excess indentation and keep lines short. Given an XML snippet in a codeblock with lines that all begin with spaces (indicated here as dots &ldquo;&middot;&rdquo;),</p><div class="code-block" data-lang="none">
··&lt;subjectdef keys=&quot;audience&quot;&gt;
····&lt;subjectdef keys=&quot;novice&quot;/&gt;
····&lt;subjectdef keys=&quot;expert&quot;/&gt;
··&lt;/subjectdef&gt;
</div><p id="12b8e5b0_51">DITA-OT can remove the leading whitespace that is common to all lines in the code block. To trim the excess space, set the <code class="code" id="12b8e5b0_52">@outputclass</code> attribute on the <code class="code" id="12b8e5b0_53">&lt;codeblock&gt;</code> element to include the <code class="code" id="12b8e5b0_54">normalize-space</code> keyword.</p><p id="12b8e5b0_55">In this case, two spaces (&ldquo;&middot;&middot;&rdquo;) would be removed from the beginning of each line, shifting content to the left by two characters, while preserving the indentation of lines that contain additional whitespace (beyond the common indent):</p><div class="code-block" data-lang="none">
&lt;subjectdef keys=&quot;audience&quot;&gt;
··&lt;subjectdef keys=&quot;novice&quot;/&gt;
··&lt;subjectdef keys=&quot;expert&quot;/&gt;
&lt;/subjectdef&gt;
</div></section><section class="chapter"><h2 id="whitespace-visualization-pdf" data-toc="whitespace-visualization-pdf">Whitespace visualization (PDF)</h2><p id="12b8e5b0_57">DITA-OT can be set to display the whitespace characters in code blocks to visualize indentation in PDF output.</p><p id="12b8e5b0_58">To enable this feature, set the <code class="code" id="12b8e5b0_59">@outputclass</code> attribute on the <code class="code" id="12b8e5b0_60">&lt;codeblock&gt;</code> element to include the <code class="code" id="12b8e5b0_61">show-whitespace</code> keyword.</p><p id="12b8e5b0_62">When PDF output is generated, space characters in the code will be replaced with a middle dot or &ldquo;interpunct&rdquo; character (&nbsp;<code class="code" id="12b8e5b0_63">&middot;</code>&nbsp;); tab characters are replaced with a rightwards arrow and three spaces (&nbsp;<code class="code" id="12b8e5b0_64">&rarr;&nbsp;&nbsp;&nbsp;</code>&nbsp;).</p><div class="code-block" data-lang="none">
	for i in 0..10 {
		println(i)
	}
</div></section><section class="chapter"><h2 id="line-numbering-pdf" data-toc="line-numbering-pdf">Line numbering (PDF)</h2><p id="12b8e5b0_66">DITA-OT can be set to add line numbers to code blocks to make it easier to distinguish specific lines.</p><p id="12b8e5b0_67">To enable this feature, set the <code class="code" id="12b8e5b0_68">@outputclass</code> attribute on the <code class="code" id="12b8e5b0_69">&lt;codeblock&gt;</code> element to include the <code class="code" id="12b8e5b0_70">show-line-numbers</code> keyword.</p><div class="code-block" data-lang="none">
	for i in 0..10 {
		println(i)
	}
</div><p id="12b8e5b0_72"><span class="control" id="12b8e5b0_73">Related information</span></p><p id="12b8e5b0_74"><a href="preprocess-topic-fragment.html" id="12b8e5b0_75" data-tooltip="The topic-fragment step expands content references to elements in the same topic and resolves references made with the &lt;coderef&gt; element. This step is implemented in SAX pipes.">Resolve topic fragments and code references (topic-fragment)</a></p></section><div class="last-modified">Last modified: 13 February 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="implementation-dependent-features.html" class="navigation-links__prev">Implementation-dependent features</a><a href="docs-dita-features.html" class="navigation-links__next">DITA features in the documentation</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.6.6-b205/app.js"></script></body></html>